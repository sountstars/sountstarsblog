<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Event-Loop | aurora blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/feature_cat.jpeg">
    <meta name="description" content="我的个人网站">
    
    <link rel="preload" href="/assets/css/0.styles.cb058343.css" as="style"><link rel="preload" href="/assets/js/app.157a43b5.js" as="script"><link rel="preload" href="/assets/js/2.52866a67.js" as="script"><link rel="preload" href="/assets/js/16.cb862ad8.js" as="script"><link rel="prefetch" href="/assets/js/10.010d567c.js"><link rel="prefetch" href="/assets/js/11.4af4b929.js"><link rel="prefetch" href="/assets/js/12.337cdcf1.js"><link rel="prefetch" href="/assets/js/13.90875d56.js"><link rel="prefetch" href="/assets/js/14.0ed7aefb.js"><link rel="prefetch" href="/assets/js/15.754a382b.js"><link rel="prefetch" href="/assets/js/17.4fa3dc3a.js"><link rel="prefetch" href="/assets/js/18.19362ae0.js"><link rel="prefetch" href="/assets/js/19.bb38661a.js"><link rel="prefetch" href="/assets/js/20.9f6dac92.js"><link rel="prefetch" href="/assets/js/21.b86ba564.js"><link rel="prefetch" href="/assets/js/22.08390e2a.js"><link rel="prefetch" href="/assets/js/23.07ce8733.js"><link rel="prefetch" href="/assets/js/24.2224abb3.js"><link rel="prefetch" href="/assets/js/25.cf2cacb2.js"><link rel="prefetch" href="/assets/js/26.0fab9c3d.js"><link rel="prefetch" href="/assets/js/27.409f3c11.js"><link rel="prefetch" href="/assets/js/28.2d999655.js"><link rel="prefetch" href="/assets/js/29.4c4b34f2.js"><link rel="prefetch" href="/assets/js/3.2452f598.js"><link rel="prefetch" href="/assets/js/30.c7e81ddc.js"><link rel="prefetch" href="/assets/js/31.87c49613.js"><link rel="prefetch" href="/assets/js/32.785f3b5f.js"><link rel="prefetch" href="/assets/js/33.d851ac79.js"><link rel="prefetch" href="/assets/js/34.f7dbbd6a.js"><link rel="prefetch" href="/assets/js/35.ecb758ea.js"><link rel="prefetch" href="/assets/js/36.478ee48d.js"><link rel="prefetch" href="/assets/js/37.b1e60efd.js"><link rel="prefetch" href="/assets/js/38.5b5e4eff.js"><link rel="prefetch" href="/assets/js/39.694373c0.js"><link rel="prefetch" href="/assets/js/4.e4d2375c.js"><link rel="prefetch" href="/assets/js/40.4a96b7b1.js"><link rel="prefetch" href="/assets/js/41.b0c17527.js"><link rel="prefetch" href="/assets/js/42.bb73ede6.js"><link rel="prefetch" href="/assets/js/43.dcd6c126.js"><link rel="prefetch" href="/assets/js/44.f643b2b9.js"><link rel="prefetch" href="/assets/js/45.194d68b8.js"><link rel="prefetch" href="/assets/js/46.a68230ef.js"><link rel="prefetch" href="/assets/js/47.0d19f838.js"><link rel="prefetch" href="/assets/js/48.d3f26e8c.js"><link rel="prefetch" href="/assets/js/49.b7740e4c.js"><link rel="prefetch" href="/assets/js/5.cb8c9fa9.js"><link rel="prefetch" href="/assets/js/50.2587ca2f.js"><link rel="prefetch" href="/assets/js/51.ea8d1c82.js"><link rel="prefetch" href="/assets/js/52.48ff45db.js"><link rel="prefetch" href="/assets/js/53.218b9ecf.js"><link rel="prefetch" href="/assets/js/54.1fa58f1d.js"><link rel="prefetch" href="/assets/js/55.d2ef0ce9.js"><link rel="prefetch" href="/assets/js/56.4a7bc600.js"><link rel="prefetch" href="/assets/js/57.b442bff3.js"><link rel="prefetch" href="/assets/js/58.542150a6.js"><link rel="prefetch" href="/assets/js/6.f0062c90.js"><link rel="prefetch" href="/assets/js/7.b156b7cb.js"><link rel="prefetch" href="/assets/js/8.dfb56ee2.js"><link rel="prefetch" href="/assets/js/9.f870735d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cb058343.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">aurora blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/sountstars" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/sountstars" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JS</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/home.html" class="sidebar-link">基本汇总</a></li><li><a href="/js/date.html" class="sidebar-link">Date时间</a></li><li><a href="/js/array.html" class="sidebar-link">Array方法</a></li><li><a href="/js/string.html" class="sidebar-link">String 方法</a></li><li><a href="/js/object.html" class="sidebar-link">Object方法</a></li><li><a href="/js/regexp.html" class="sidebar-link">RegExp正则</a></li><li><a href="/js/feature.html" class="sidebar-link">Es6 新特性等</a></li><li><a href="/js/eventloop.html" aria-current="page" class="active sidebar-link">Event-Loop</a></li><li><a href="/js/http_https.html" class="sidebar-link">Http and Https</a></li><li><a href="/js/for_on_for_in.html" class="sidebar-link">for in和for of区别</a></li><li><a href="/js/web_worker.html" class="sidebar-link">Web Worker</a></li><li><a href="/js/promise.html" class="sidebar-link">Promise &amp;&amp; async</a></li><li><a href="/js/heap.html" class="sidebar-link">堆内存 &amp; 栈内存</a></li><li><a href="/js/design.html" class="sidebar-link">JS设计模式探索</a></li><li><a href="/js/npm_yarn.html" class="sidebar-link">npm &amp; yarn</a></li><li><a href="/js/fetch_axios.html" class="sidebar-link">Fetch和Axios的区别</a></li><li><a href="/js/interview.html" class="sidebar-link">学习及面试问题整理</a></li><li><a href="/js/url_process.html" class="sidebar-link">URL 输入到页面加载过程</a></li><li><a href="/js/proxy.html" class="sidebar-link">跨域&amp;nginx本地项目代理</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>FE框架</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>构建工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Typescript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Servers</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git命令</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Other</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="event-loop"><a href="#event-loop" class="header-anchor">#</a> Event-Loop</h1> <p></p><div class="table-of-contents"><ul><li><a href="#同步-异步-多线程">同步 &amp; 异步 &amp; 多线程</a></li><li><a href="#js中的异步操作">JS中的异步操作</a></li><li><a href="#event-loop-事件轮询">event-loop（事件轮询）</a></li><li><a href="#宏任务-微任务">宏任务 &amp; 微任务</a></li><li><a href="#async-await-和-promise-的执行顺序">async/await 和 promise 的执行顺序</a><ul><li><a href="#async">async</a></li><li><a href="#await">await</a></li></ul></li></ul></div><p></p> <h2 id="同步-异步-多线程"><a href="#同步-异步-多线程" class="header-anchor">#</a> 同步 &amp; 异步 &amp; 多线程</h2> <p><strong>同步与异步的区别</strong></p> <p>同步（Synchronous）：在执行某个操作时，应用程序必须<code>等待该操作执行完成后</code>才能继续执行。<br>
异步（Asynchronous）：在执行某个操作时，应用程序可在异步操作执行时继续执行。实质：异步操作，启动了新的，线程主线程与方法线程并行执行。<code>异步任务是不会进入主线程，而是会先进入任务队列</code></p> <p><strong>异步和多线程的区别</strong></p> <p>我们已经知道， 异步和多线程并不是一个同等关系,<code>异步是最终目的,多线程只是我们实现异步的一种手段</code>。异步是当一个调用请求发送给被调用者,而调用者不用等待其结果的返回而可以做其它的事情。实现异步可以采用多线程技术或则交给另外的进程来处理。</p> <p>简单的说就是：异步线程是由<code>线程池</code>负责管理，而多线程，我们可以自己控制，当然在多线程中我们也可以使用线程池。</p> <p><a href="http://www.ruanyifeng.com/blog/2014/10/event-loop.html" target="_blank" rel="noopener noreferrer">机制详解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="js中的异步操作"><a href="#js中的异步操作" class="header-anchor">#</a> JS中的异步操作</h2> <ul><li><p>定时函数，如setTimeout setInterval requestAnimationFrame setImmediate(nodeJS）</p> <ul><li>IO 操作（输入/输出），如readFile readdir</li> <li>网络请求，如ajax http.get（也可以同步，但是等待ajax请求响应之前，页面会卡住，用户什么都做不了,体验差）</li></ul></li> <li><p>事件绑定都是异步操作</p> <ul><li>除了IO设备的事件以外，还包括一些用户产生的事件（比如鼠标点击、页面滚动等等）只要指定过回调函数，这些事件发生时就会进入&quot;任务队列&quot;，等待主线程读取。</li></ul></li> <li><p>回调函数可以理解为异步（不是严谨的异步操作，同步回调，异步回调）</p> <ul><li>所谓&quot;回调函数&quot;（callback），就是那些会被主线程挂起来的代码。异步任务必须指定回调函数，当主线程开始执行异步任务，就是执行对应的回调函数。</li></ul></li></ul> <h2 id="event-loop-事件轮询"><a href="#event-loop-事件轮询" class="header-anchor">#</a> event-loop（事件轮询）</h2> <p><img src="/assets/img/event_loop.2178b0c3.jpg" alt="solar">
主线程运行的时候，产生堆（heap）和栈（stack），栈中的代码调用各种外部API， 它们在&quot;任务队列&quot;中加入各种事件（click，load，done）。只要栈中的代码执行完毕，主线程就会去读取&quot;<code>任务队列（task queue）</code>&quot;，依次执行那些事件所对应的回调函数</p> <h2 id="宏任务-微任务"><a href="#宏任务-微任务" class="header-anchor">#</a> 宏任务 &amp; 微任务</h2> <p><strong><code>微任务的优先级⽐宏任务的优先级要高</code></strong></p> <ul><li><p><strong>浏览器的任务队列:</strong> -主任务队列:存储的都是同步任务</p> <ul><li>等待任务队列:存储的都是异步任务</li></ul></li> <li><p><strong>微任务:</strong></p> <ul><li>Promise的then回调函数</li> <li>async函数中await下面的代码</li> <li>process.nextTick（nodeJS）</li> <li>MutationObserver(观察DOM树结构发生变化)</li></ul></li> <li><p><strong>宏任务:</strong></p> <ul><li>定时器(setInterval/setTimeout)</li> <li>requestAnimationFrame（专门用于处理动画的API）</li> <li>setImmediate(nodeJS)</li></ul></li></ul> <h2 id="async-await-和-promise-的执行顺序"><a href="#async-await-和-promise-的执行顺序" class="header-anchor">#</a> async/await 和 promise 的执行顺序</h2> <h3 id="async"><a href="#async" class="header-anchor">#</a> async</h3> <p><strong>带 async 关键字的函数，它使得你的函数的返回值必定是 promise 对象</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">123</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">/*
Promise {&lt;resolved&gt;: 123}
*/</span>
</code></pre></div><h3 id="await"><a href="#await" class="header-anchor">#</a> await</h3> <p>两种情况</p> <ul><li>不是promise对象</li> <li>是promise对象</li></ul> <p><strong>如果不是 promise（<code>会被转成一个立即resolve的 Promise 对象</code>） , await会阻塞后面（并非await后面那个函数）的代码，先执行async函数<code>外面</code>的同步代码，同步代码执行完，再回到async内部，据需执行下面的方法</strong></p> <p><strong>如果它等到的是一个 promise 对象，await 也会<code>暂停</code>async后面的代码，先执行async函数外面的同步代码，<code>等着Promise对象fulfilled</code>，然后把 resolve 的参数作为 await 表达式的运算结果，然后在继续向下执行剩余的代码</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">ff</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//【1】</span>
    <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span><span class="token comment">//【2】</span>
    <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//【3】</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
            <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//【4】</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'外面'</span><span class="token punctuation">)</span><span class="token comment">//【5】</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/*
解析：async函数下的方法，就想成跟普通的函数一样的就行，函数先执行【1】然后执行到await执行的async2，Promise内部相当于同步函数，然后执行【3】，
然后执行async外面的方法，发现没有，然后又回到ff函数内部，执行resolve里面的函数【4】,最后就该轮到【2】和【4】
*/</span>

<span class="token comment">/*
* async1 start
* 11
* 22
* async1 end
* 外面
*/</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/js/feature.html" class="prev">
        Es6 新特性等
      </a></span> <span class="next"><a href="/js/http_https.html">
        Http and Https
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.157a43b5.js" defer></script><script src="/assets/js/2.52866a67.js" defer></script><script src="/assets/js/16.cb862ad8.js" defer></script>
  </body>
</html>
